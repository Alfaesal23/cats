<html><head><title>Cats: Eval</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Cats contributors" /><meta name="description" content="Lightweight, modular, and extensible library for functional programming" /><meta name="og:image" content="/cats/img/poster.png" /><meta name="og:title" content="Cats: Eval" /><meta name="og:site_name" content="Cats" /><meta name="og:url" content="http://typelevel.org/cats/" /><meta name="og:type" content="website" /><meta name="og:description" content="Lightweight, modular, and extensible library for functional programming" /><link rel="icon" type="image/png" href="/cats/img/favicon.png" /><meta name="twitter:title" content="Cats: Eval" /><meta name="twitter:image" content="http://typelevel.org/cats/img/poster.png" /><meta name="twitter:description" content="Lightweight, modular, and extensible library for functional programming" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/cats/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/cats/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/cats/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/cats/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/cats/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/cats/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/cats/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/cats/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/cats/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/cats/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/cats/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/cats/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/cats/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/cats/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/cats/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/cats/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/cats/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/cats/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/cats/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/cats/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/cats/highlight/styles/atom-one-light.css" /><link rel="stylesheet" href="/cats/css/style.css" /><link rel="stylesheet" href="/cats/css/palette.css" /><link rel="stylesheet" href="/cats/css/codemirror.css" /><link rel="stylesheet" href="/cats/css/override.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/cats/" class="brand"><div class="brand-wrapper"><span>Cats</span></div></a></li>                  <li><a href="/cats/datatypes.html" class="">Data Types</a></li> <li><a href="/cats/datatypes/chain.html" class="">Chain</a></li> <li><a href="/cats/datatypes/const.html" class="">Const</a></li> <li><a href="/cats/datatypes/either.html" class="">Either</a></li> <li><a href="/cats/datatypes/eval.html" class=" active ">Eval</a></li> <li><a href="/cats/datatypes/freeapplicative.html" class="">FreeApplicatives</a></li> <li><a href="/cats/datatypes/freemonad.html" class="">FreeMonads</a></li> <li><a href="/cats/datatypes/functionk.html" class="">FunctionK</a></li> <li><a href="/cats/datatypes/id.html" class="">Id</a></li> <li><a href="/cats/datatypes/ior.html" class="">Ior</a></li> <li><a href="/cats/datatypes/kleisli.html" class="">Kleisli</a></li> <li><a href="/cats/datatypes/nested.html" class="">Nested</a></li> <li><a href="/cats/datatypes/nel.html" class="">NonEmptyList</a></li> <li><a href="/cats/datatypes/oneand.html" class="">OneAnd</a></li> <li><a href="/cats/datatypes/optiont.html" class="">OptionT</a></li> <li><a href="/cats/datatypes/eithert.html" class="">EitherT</a></li> <li><a href="/cats/datatypes/iort.html" class="">IorT</a></li> <li><a href="/cats/datatypes/state.html" class="">State</a></li> <li><a href="/cats/datatypes/validated.html" class="">Validated</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/typelevel/cats"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/typelevel/cats"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('Cats Lightweight, modular, and extensible library for functional programming');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('Cats Lightweight, modular, and extensible library for functional programming');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="typelevel" data-github-repo="cats"><div class="content-wrapper"><section><h1 id="eval">Eval</h1>

<p>Eval is a data type for controlling synchronous evaluation.
Its implementation is designed to provide stack-safety at all times using a technique called trampolining.</p>

<p>There are two different factors that play into evaluation: memoization and laziness.</p>

<p>Memoized evaluation evaluates an expression only once and then remembers (memoizes) that value.
Lazy evaluation refers to when the expression is evaluated.
We talk about eager evaluation if the expression is immediately evaluated when defined and about lazy evaluation if the expression is evaluated when it’s first used.</p>

<p>For example, in Scala, a <code class="highlighter-rouge">lazy val</code> is both lazy and memoized, a method definition <code class="highlighter-rouge">def</code> is lazy, but not memoized, since the body will be evaluated on every call.
A normal <code class="highlighter-rouge">val</code> evaluates eagerly and also memoizes the result.</p>

<p><code class="highlighter-rouge">Eval</code> is able to express all of these evaluation strategies and allows us to chain computations using its <code class="highlighter-rouge">Monad</code> instance.</p>

<h4 id="evalnow">Eval.now</h4>

<p>First of the strategies is eager evaluation, we can construct an <code class="highlighter-rouge">Eval</code> eagerly using <code class="highlighter-rouge">Eval.now</code>:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cats.Eval</span>
<span class="c1">// import cats.Eval
</span>
<span class="k">import</span> <span class="nn">cats.implicits._</span>
<span class="c1">// import cats.implicits._
</span>
<span class="k">val</span> <span class="n">eager</span> <span class="k">=</span> <span class="nc">Eval</span><span class="o">.</span><span class="n">now</span> <span class="o">{</span>
  <span class="n">println</span><span class="o">(</span><span class="s">"Running expensive calculation..."</span><span class="o">)</span>
  <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">3</span>
<span class="o">}</span>
<span class="c1">// Running expensive calculation...
// eager: cats.Eval[Int] = Now(7)
</span></code></pre>
</div>

<p>We can run the computation using the given evaluation strategy anytime by using the <code class="highlighter-rouge">value</code> method.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">eager</span><span class="o">.</span><span class="n">value</span>
<span class="c1">// res0: Int = 7
</span></code></pre>
</div>

<h4 id="evallater">Eval.later</h4>

<p>If we want lazy evaluation, we can use <code class="highlighter-rouge">Eval.later</code>:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">lazyEval</span> <span class="k">=</span> <span class="nc">Eval</span><span class="o">.</span><span class="n">later</span> <span class="o">{</span>
  <span class="n">println</span><span class="o">(</span><span class="s">"Running expensive calculation..."</span><span class="o">)</span>
  <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">3</span>
<span class="o">}</span>
<span class="c1">// lazyEval: cats.Eval[Int] = cats.Later@4a2ec8cd
</span>
<span class="n">lazyEval</span><span class="o">.</span><span class="n">value</span>
<span class="c1">// Running expensive calculation...
// res1: Int = 7
</span>
<span class="n">lazyEval</span><span class="o">.</span><span class="n">value</span>
<span class="c1">// res2: Int = 7
</span></code></pre>
</div>

<p>Notice that “Running expensive calculation” is printed only once, since the value was memoized internally.
<code class="highlighter-rouge">Eval.later</code> is different to using a <code class="highlighter-rouge">lazy val</code> in a few different ways.
First, it allows the runtime to perform garbage collection of the thunk after evaluation, leading to more memory being freed earlier.
Secondly, when <code class="highlighter-rouge">lazy val</code>s are evaluated, in order to preserve thread-safety, the Scala compiler will lock the whole surrounding class, whereas <code class="highlighter-rouge">Eval</code> will only lock itself.</p>

<h4 id="evalalways">Eval.always</h4>

<p>If we want lazy evaluation, but without memoization akin to <code class="highlighter-rouge">Function0</code>, we can use <code class="highlighter-rouge">Eval.always</code></p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">always</span> <span class="k">=</span> <span class="nc">Eval</span><span class="o">.</span><span class="n">always</span> <span class="o">{</span>
  <span class="n">println</span><span class="o">(</span><span class="s">"Running expensive calculation..."</span><span class="o">)</span>
  <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">3</span>
<span class="o">}</span>
<span class="c1">// always: cats.Eval[Int] = cats.Always@60925c8c
</span>
<span class="n">always</span><span class="o">.</span><span class="n">value</span>
<span class="c1">// Running expensive calculation...
// res3: Int = 7
</span>
<span class="n">always</span><span class="o">.</span><span class="n">value</span>
<span class="c1">// Running expensive calculation...
// res4: Int = 7
</span></code></pre>
</div>

<p>Here we can see, that the expression is evaluated every time we call <code class="highlighter-rouge">.value</code>.</p>

<h3 id="chaining-lazy-computations">Chaining lazy computations</h3>

<p>One of the most useful applications of <code class="highlighter-rouge">Eval</code> is its ability to chain together computations in a stack-safe way.
You can see one such usage when looking at the <code class="highlighter-rouge">foldRight</code> method found in <a href="../typeclasses/foldable.html"><code class="highlighter-rouge">Foldable</code></a>.
Another great example are mutual tail-recursive calls:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">object</span> <span class="nc">MutualRecursion</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">even</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Eval</span><span class="o">[</span><span class="kt">Boolean</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Eval</span><span class="o">.</span><span class="n">always</span><span class="o">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="o">).</span><span class="n">flatMap</span> <span class="o">{</span>
      <span class="k">case</span> <span class="kc">true</span> <span class="k">=&gt;</span> <span class="nc">Eval</span><span class="o">.</span><span class="n">now</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
      <span class="k">case</span> <span class="kc">false</span> <span class="k">=&gt;</span> <span class="n">odd</span><span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
    <span class="o">}</span>

  <span class="k">def</span> <span class="n">odd</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Eval</span><span class="o">[</span><span class="kt">Boolean</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Eval</span><span class="o">.</span><span class="n">always</span><span class="o">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="o">).</span><span class="n">flatMap</span> <span class="o">{</span>
      <span class="k">case</span> <span class="kc">true</span> <span class="k">=&gt;</span> <span class="nc">Eval</span><span class="o">.</span><span class="n">now</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
      <span class="k">case</span> <span class="kc">false</span> <span class="k">=&gt;</span> <span class="n">even</span><span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">// defined object MutualRecursion
</span>
<span class="nc">MutualRecursion</span><span class="o">.</span><span class="n">odd</span><span class="o">(</span><span class="mi">199999</span><span class="o">).</span><span class="n">value</span>
<span class="c1">// res5: Boolean = true
</span></code></pre>
</div>

<p>Because <code class="highlighter-rouge">Eval</code> guarantees stack-safety, we can chain a lot of computations together using <code class="highlighter-rouge">flatMap</code> without fear of blowing up the stack.</p>

<p>You can also use <code class="highlighter-rouge">Eval.defer</code> to defer any computation that will return an <code class="highlighter-rouge">Eval[A]</code>.
This is useful, because nesting a call to <code class="highlighter-rouge">.value</code> inside any of the <code class="highlighter-rouge">Eval</code> creation methods can be unsafe.</p>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/cats/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script>((window.gitter = {}).chat = {}).options = {
room: 'typelevel/cats'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/cats/js/main.js"></script></body></html>